# E7æ£‹ç‰Œå®¤è®°è´¦ç³»ç»Ÿ - é¡¹ç›®åˆ†æä¸é‡æ„è·¯çº¿è§„åˆ’

## ğŸ“Š ä¸€ã€å½“å‰é¡¹ç›®çŠ¶æ€åˆ†æ

### 1.1 é¡¹ç›®ç±»å‹åˆ¤å®š

**âœ… ç¡®è®¤ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„PWAåº”ç”¨**

æ ¹æ®é¡¹ç›®åˆ†æï¼Œè¯¥é¡¹ç›®å…·å¤‡å®Œæ•´çš„PWAç‰¹å¾ï¼š

- âœ… **Service Worker** (`sw.js:1-141`) - å®ç°ç¦»çº¿ç¼“å­˜å’Œèµ„æºç®¡ç†
- âœ… **Web App Manifest** (`manifest.json:1-25`) - å®šä¹‰åº”ç”¨å…ƒæ•°æ®å’Œå›¾æ ‡
- âœ… **PWA Metaæ ‡ç­¾** (`index.html:10-22`) - iOS/Android PWAä¸“ç”¨é…ç½®
- âœ… **ç¦»çº¿æ”¯æŒ** - ä½¿ç”¨LocalStorageè¿›è¡Œæœ¬åœ°æ•°æ®å­˜å‚¨
- âœ… **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯ä¼˜å…ˆçš„UIè®¾è®¡

### 1.2 å½“å‰æŠ€æœ¯æ ˆ

```yaml
å‰ç«¯æ¡†æ¶: Vue.js 2.6.14 (é€šè¿‡CDNå¼•å…¥)
UIæ¶æ„: Vanilla CSS + ç»„ä»¶åŒ–è®¾è®¡
æ•°æ®æŒä¹…åŒ–:
  - æœ¬åœ°: LocalStorage
  - äº‘ç«¯: Supabase (PostgreSQL)
æ‰“åŒ…å·¥å…·: æ—  (çº¯é™æ€HTML+JS)
ç§»åŠ¨ç«¯æ–¹æ¡ˆ:
  - PWA: å®Œæ•´æ”¯æŒ
  - æ··åˆåº”ç”¨: Capacitor 7.4.3 (å·²é…ç½®Android)
```

### 1.3 é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
e7-accounting-system-main/
â”œâ”€â”€ index.html              # ä¸»åº”ç”¨é¡µé¢
â”œâ”€â”€ auth.html               # è®¤è¯é¡µé¢
â”œâ”€â”€ splash.html             # å¯åŠ¨é¡µ
â”œâ”€â”€ main-modular.js         # Vueåº”ç”¨å…¥å£(æ¨¡å—åŒ–)
â”œâ”€â”€ sw.js                   # Service Worker
â”œâ”€â”€ manifest.json           # PWAé…ç½®
â”œâ”€â”€ capacitor.config.json   # Capacitoré…ç½®(å·²å­˜åœ¨)
â”œâ”€â”€ package.json            # Capacitorä¾èµ–
â”œâ”€â”€ android/                # AndroidåŸç”Ÿé¡¹ç›®(å·²ç”Ÿæˆ)
â”œâ”€â”€ modules/                # åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ supabase.js         # Supabaseè®¤è¯
â”‚   â”œâ”€â”€ supabaseData.js     # æ•°æ®åŒæ­¥
â”‚   â”œâ”€â”€ dataManager.js      # æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ statistics.js       # ç»Ÿè®¡æ¨¡å—
â”‚   â”œâ”€â”€ tobacco.js          # çƒŸè‰ç®¡ç†
â”‚   â””â”€â”€ ...
â””â”€â”€ components/             # Vueç»„ä»¶
```

---

## ğŸ¯ äºŒã€è¿ç§»ä¸ºåŸç”ŸAppçš„å¯è¡Œæ€§è¯„ä¼°

### 2.1 é€‚åˆè¿ç§»çš„ç†ç”±

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| âœ… **å·²æœ‰CapacitoråŸºç¡€** | é¡¹ç›®å·²é…ç½®Capacitor 7.4.3ï¼Œæœ‰androidç›®å½•å’Œé…ç½®æ–‡ä»¶ |
| âœ… **ä¸šåŠ¡é€»è¾‘æ¸…æ™°** | æ¨¡å—åŒ–è®¾è®¡è‰¯å¥½ï¼Œ6å¤§æ ¸å¿ƒæ¨¡å—èŒè´£æ˜ç¡® |
| âœ… **æ•°æ®å±‚æˆç†Ÿ** | Supabaseåç«¯æä¾›å®Œæ•´çš„è®¤è¯å’Œæ•°æ®åŒæ­¥ |
| âœ… **ç§»åŠ¨ç«¯ä¼˜åŒ–** | PWAå·²é€‚é…ç§»åŠ¨ç«¯ï¼Œå­˜åœ¨è§¦æ‘¸æ‰‹åŠ¿ã€ç§»åŠ¨ç«¯é€‰æ‹©å™¨ç­‰ |
| âœ… **ç¦»çº¿æ”¯æŒå®Œæ•´** | Service Worker + LocalStorageåŒé‡ä¿éšœ |

### 2.2 è¿ç§»æ”¶ç›Šåˆ†æ

**åŸç”ŸAppç›¸æ¯”PWAçš„ä¼˜åŠ¿ï¼š**

1. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**
   - åº”ç”¨å•†åº—åˆ†å‘ï¼Œç”¨æˆ·ä¿¡ä»»åº¦é«˜
   - æ›´æµç•…çš„å¯åŠ¨é€Ÿåº¦
   - æ— æµè§ˆå™¨UIå¹²æ‰°

2. **æ›´å¼ºçš„ç³»ç»Ÿé›†æˆ**
   - è®¿é—®åŸç”ŸAPIï¼ˆç›¸æœºã€æ–‡ä»¶ç³»ç»Ÿã€ç”Ÿç‰©è¯†åˆ«ç­‰ï¼‰
   - æ¨é€é€šçŸ¥æ›´å¯é 
   - æ›´å¥½çš„åå°è¿è¡Œèƒ½åŠ›

3. **å•†ä¸šä»·å€¼**
   - å¯ä¸Šæ¶Google Play/App Store
   - æ›´ä¸“ä¸šçš„å“ç‰Œå½¢è±¡
   - æ›´å®¹æ˜“è¿›è¡Œå•†ä¸šåŒ–

### 2.3 æŠ€æœ¯éš¾åº¦è¯„ä¼°

```
éš¾åº¦ç­‰çº§: â­â­â˜†â˜†â˜† (ä¸­ä½éš¾åº¦)

ç†ç”±:
1. å·²æœ‰Capacitoré…ç½®ï¼ŒåŸºç¡€å·¥ä½œå®Œæˆ70%
2. Vue 2.6ä»£ç å¯ç›´æ¥è¿ç§»åˆ°Vue 3
3. Supabase SDKå®Œç¾æ”¯æŒç§»åŠ¨ç«¯
4. æ— å¤æ‚çš„åŸç”ŸåŠŸèƒ½éœ€æ±‚
```

---

## ğŸ”§ ä¸‰ã€å‰ç«¯æ¡†æ¶é€‰å‹å»ºè®®

### 3.1 æ¡†æ¶å¯¹æ¯”åˆ†æ

| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | ä¸Supabaseå…¼å®¹æ€§ | æ¨èæŒ‡æ•° |
|------|------|------|-----------------|---------|
| **Vue 3** | â€¢ å­¦ä¹ æ›²çº¿å¹³æ»‘<br>â€¢ ä¸å½“å‰Vue 2ä»£ç ç›¸ä¼¼<br>â€¢ Composition APIé€‚åˆä¸šåŠ¡é€»è¾‘<br>â€¢ ç”Ÿæ€æˆç†Ÿ | â€¢ æ€§èƒ½ç•¥é€ŠäºSvelte | â­â­â­â­â­ | â­â­â­â­â­ |
| **React** | â€¢ ç”Ÿæ€æœ€ä¸°å¯Œ<br>â€¢ æ‹›è˜äººæ‰å¤š<br>â€¢ React Nativeå¯å¤ç”¨ä»£ç  | â€¢ éœ€è¦é‡å†™æ‰€æœ‰ç»„ä»¶<br>â€¢ å­¦ä¹ æˆæœ¬é«˜ | â­â­â­â­â­ | â­â­â­â˜†â˜† |
| **Svelte** | â€¢ æ€§èƒ½æœ€ä¼˜<br>â€¢ æ‰“åŒ…ä½“ç§¯å°<br>â€¢ è¯­æ³•ç®€æ´ | â€¢ ç”Ÿæ€è¾ƒå°<br>â€¢ æ‹›è˜å›°éš¾ | â­â­â­â­â˜† | â­â­â­â­â˜† |

### 3.2 æœ€ç»ˆæ¨èï¼šVue 3

**é€‰æ‹©ç†ç”±ï¼š**

1. **è¿ç§»æˆæœ¬æœ€ä½**
   - å½“å‰é¡¹ç›®ä½¿ç”¨Vue 2.6ï¼Œè¿ç§»åˆ°Vue 3åªéœ€é€‚é…Composition API
   - 90%çš„æ¨¡æ¿è¯­æ³•ä¿æŒä¸å˜
   - æ¸è¿›å¼å‡çº§ï¼Œå¯é€æ­¥é‡æ„

2. **ä¸Supabaseå®Œç¾å¥‘åˆ**
   - Supabaseå®˜æ–¹æä¾›Vueé›†æˆç¤ºä¾‹
   - `@supabase/supabase-js` åœ¨Vue 3ä¸­è¡¨ç°ä¼˜å¼‚
   - PiniaçŠ¶æ€ç®¡ç†ä¸Supabaseå®æ—¶è®¢é˜…é…åˆè‰¯å¥½

3. **ç”Ÿæ€ç³»ç»Ÿæˆç†Ÿ**
   - Vite (è¶…å¿«çš„æ„å»ºå·¥å…·)
   - Pinia (è½»é‡çº§çŠ¶æ€ç®¡ç†)
   - Vue Router 4 (è·¯ç”±ç®¡ç†)
   - Naive UI / Vant 4 (ç§»åŠ¨ç«¯ç»„ä»¶åº“)

4. **å›¢é˜Ÿå»¶ç»­æ€§**
   - ç°æœ‰ä»£ç å¯å¤ç”¨
   - å­¦ä¹ æˆæœ¬æœ€ä½
   - ç»´æŠ¤ä¸€è‡´çš„å¼€å‘ä½“éªŒ

---

## ğŸ—ï¸ å››ã€æ¨èæŠ€æœ¯æ ˆæ–¹æ¡ˆ

### 4.1 å®Œæ•´æŠ€æœ¯æ ˆ

```yaml
# å‰ç«¯æ¡†æ¶
Framework: Vue 3.4+ (Composition API)
æ„å»ºå·¥å…·: Vite 5.0+
çŠ¶æ€ç®¡ç†: Pinia
è·¯ç”±ç®¡ç†: Vue Router 4
UIç»„ä»¶åº“: Vant 4 (ç§»åŠ¨ç«¯) / Naive UI (å¯é€‰)

# ç§»åŠ¨ç«¯æ–¹æ¡ˆ
æ··åˆåº”ç”¨: Capacitor 6.x (æœ€æ–°ç¨³å®šç‰ˆ)
å¹³å°æ”¯æŒ: Android + iOS

# åç«¯æœåŠ¡
BaaSå¹³å°: Supabase
è®¤è¯: Supabase Auth (Email/OAuth)
æ•°æ®åº“: PostgreSQL (Supabase)
å®æ—¶è®¢é˜…: Supabase Realtime
å­˜å‚¨: Supabase Storage

# å¼€å‘å·¥å…·
è¯­è¨€: TypeScript 5.0+
ä»£ç è§„èŒƒ: ESLint + Prettier
Gité’©å­: Husky + lint-staged
æµ‹è¯•æ¡†æ¶: Vitest (å¯é€‰)

# å·¥å…·åº“
HTTPå®¢æˆ·ç«¯: @supabase/supabase-js
æ—¥æœŸå¤„ç†: Day.js
å›¾è¡¨: ECharts / Chart.js
å·¥å…·å‡½æ•°: VueUse
```

### 4.2 ä¸Supabaseçš„é›†æˆä¼˜åŠ¿

```javascript
// ç¤ºä¾‹ï¼šVue 3 + Supabaseå®Œç¾é›†æˆ
import { createClient } from '@supabase/supabase-js'
import { ref, onMounted } from 'vue'

// 1. è®¤è¯çŠ¶æ€è‡ªåŠ¨åŒæ­¥
const user = ref(null)
const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
  user.value = session?.user ?? null
})

// 2. å®æ—¶æ•°æ®è®¢é˜…
const records = ref([])
const channel = supabase
  .channel('records')
  .on('postgres_changes',
    { event: '*', schema: 'public', table: 'records' },
    (payload) => {
      // è‡ªåŠ¨æ›´æ–°UI
      records.value = [...records.value, payload.new]
    }
  )
  .subscribe()

// 3. è‡ªåŠ¨ç¼“å­˜å’Œç¦»çº¿æ”¯æŒ
// Capacitor Preferences API + Supabase
```

---

## ğŸ“‹ äº”ã€é‡æ„è·¯çº¿è§„åˆ’æ–‡æ¡£

### é˜¶æ®µä¸€ï¼šå‡†å¤‡ä¸ç¯å¢ƒæ­å»º (1-2å‘¨)

#### 1.1 é¡¹ç›®åˆå§‹åŒ–

```bash
# åˆ›å»ºVue 3é¡¹ç›®
npm create vite@latest e7-accounting-app -- --template vue-ts

# å®‰è£…æ ¸å¿ƒä¾èµ–
cd e7-accounting-app
npm install vue-router@4 pinia
npm install @supabase/supabase-js
npm install vant@4
npm install @vueuse/core dayjs
npm install -D @capacitor/cli @capacitor/core
npm install @capacitor/android @capacitor/ios
npm install @capacitor/preferences @capacitor/camera @capacitor/filesystem
```

#### 1.2 é¡¹ç›®ç»“æ„è®¾è®¡

```
e7-accounting-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts                 # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.vue                 # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ router/                 # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ stores/                 # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ records.ts          # è®°è´¦è®°å½•
â”‚   â”‚   â”œâ”€â”€ debts.ts            # å€ºåŠ¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ tobacco.ts          # çƒŸè‰æ¶ˆè´¹
â”‚   â”œâ”€â”€ views/                  # é¡µé¢è§†å›¾
â”‚   â”‚   â”œâ”€â”€ RecordsView.vue     # è®°è´¦é¡µ
â”‚   â”‚   â”œâ”€â”€ DebtsView.vue       # å€ºåŠ¡é¡µ
â”‚   â”‚   â”œâ”€â”€ StatsView.vue       # ç»Ÿè®¡é¡µ
â”‚   â”‚   â”œâ”€â”€ TobaccoView.vue     # çƒŸè‰é¡µ
â”‚   â”‚   â””â”€â”€ ProfileView.vue     # ä¸ªäººä¸­å¿ƒ
â”‚   â”œâ”€â”€ components/             # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ TitleBadge.vue
â”‚   â”‚   â”œâ”€â”€ AmountChip.vue
â”‚   â”‚   â””â”€â”€ CategoryPicker.vue
â”‚   â”œâ”€â”€ composables/            # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ useSupabase.ts      # Supabaseå°è£…
â”‚   â”‚   â”œâ”€â”€ useRecords.ts       # è®°è´¦é€»è¾‘
â”‚   â”‚   â””â”€â”€ useStatistics.ts    # ç»Ÿè®¡é€»è¾‘
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ supabase.ts         # Supabaseé…ç½®
â”‚   â”‚   â”œâ”€â”€ storage.ts          # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â””â”€â”€ sync.ts             # æ•°æ®åŒæ­¥
â”‚   â”œâ”€â”€ types/                  # TypeScriptç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ assets/                 # é™æ€èµ„æº
â”œâ”€â”€ capacitor.config.ts         # Capacitoré…ç½®
â”œâ”€â”€ vite.config.ts              # Viteé…ç½®
â””â”€â”€ tsconfig.json               # TSé…ç½®
```

#### 1.3 å¼€å‘ç¯å¢ƒé…ç½®

**vite.config.ts**
```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { VantResolver } from 'unplugin-vue-components/resolvers'
import Components from 'unplugin-vue-components/vite'

export default defineConfig({
  plugins: [
    vue(),
    Components({
      resolvers: [VantResolver()],
    }),
  ],
  server: {
    host: '0.0.0.0', // å…è®¸å±€åŸŸç½‘è®¿é—®
    port: 5173,
  },
})
```

**capacitor.config.ts**
```typescript
import { CapacitorConfig } from '@capacitor/cli'

const config: CapacitorConfig = {
  appId: 'com.e7.accounting',
  appName: 'E7è®°è´¦',
  webDir: 'dist',
  server: {
    androidScheme: 'https'
  },
  plugins: {
    SplashScreen: {
      launchShowDuration: 2000,
      backgroundColor: "#ffffff",
    },
  },
}

export default config
```

---

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½è¿ç§» (3-4å‘¨)

#### 2.1 SupabaseæœåŠ¡å±‚æ­å»º

**services/supabase.ts**
```typescript
import { createClient } from '@supabase/supabase-js'
import type { Database } from '@/types/database.types'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient<Database>(supabaseUrl, supabaseKey, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
  },
})
```

**stores/auth.ts**
```typescript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { supabase } from '@/services/supabase'

export const useAuthStore = defineStore('auth', () => {
  const user = ref(null)
  const loading = ref(false)

  const isAuthenticated = computed(() => !!user.value)

  async function signIn(email: string, password: string) {
    loading.value = true
    const { data, error } = await supabase.auth.signInWithPassword({
      email, password
    })
    if (error) throw error
    user.value = data.user
    loading.value = false
  }

  async function signOut() {
    await supabase.auth.signOut()
    user.value = null
  }

  // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
  supabase.auth.onAuthStateChange((event, session) => {
    user.value = session?.user ?? null
  })

  return { user, loading, isAuthenticated, signIn, signOut }
})
```

#### 2.2 æ•°æ®æ¨¡å‹è¿ç§»

**stores/records.ts**
```typescript
import { defineStore } from 'pinia'
import { ref } from 'vue'
import { supabase } from '@/services/supabase'
import { useAuthStore } from './auth'

export const useRecordsStore = defineStore('records', () => {
  const incomes = ref([])
  const expenses = ref([])
  const loading = ref(false)

  async function fetchRecords(date: string) {
    const authStore = useAuthStore()
    loading.value = true

    const { data, error } = await supabase
      .from('records')
      .select('*')
      .eq('user_id', authStore.user.id)
      .eq('date', date)

    if (error) throw error

    incomes.value = data.filter(r => r.type === 'income')
    expenses.value = data.filter(r => r.type === 'expense')
    loading.value = false
  }

  async function addIncome(amount: number, category: string) {
    const authStore = useAuthStore()
    const { data, error } = await supabase
      .from('records')
      .insert({
        user_id: authStore.user.id,
        type: 'income',
        amount,
        category,
        date: new Date().toISOString().split('T')[0]
      })
      .select()
      .single()

    if (error) throw error
    incomes.value.push(data)
  }

  // è®¢é˜…å®æ—¶æ›´æ–°
  function subscribeToChanges(date: string) {
    const authStore = useAuthStore()

    supabase
      .channel('records')
      .on('postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'records',
          filter: `user_id=eq.${authStore.user.id}`
        },
        (payload) => {
          // å®æ—¶æ›´æ–°æœ¬åœ°æ•°æ®
          if (payload.eventType === 'INSERT') {
            if (payload.new.type === 'income') {
              incomes.value.push(payload.new)
            } else {
              expenses.value.push(payload.new)
            }
          }
        }
      )
      .subscribe()
  }

  return { incomes, expenses, loading, fetchRecords, addIncome, subscribeToChanges }
})
```

#### 2.3 UIç»„ä»¶è¿ç§»

**views/RecordsView.vue**
```vue
<template>
  <div class="records-view">
    <van-nav-bar title="è®°è´¦" fixed placeholder />

    <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
    <div class="date-picker">
      <van-button @click="goToYesterday" icon="arrow-left" />
      <van-field v-model="currentDate" readonly @click="showDatePicker = true" />
      <van-button @click="goToNextDay" icon="arrow" />
    </div>

    <!-- è¿›è´¦åˆ—è¡¨ -->
    <van-cell-group title="è¿›è´¦è®°å½•">
      <van-swipe-cell v-for="(income, index) in incomes" :key="income.id">
        <van-cell :title="`ç¬¬${index + 1}åœº`" :value="`${income.amount}å…ƒ`" />
        <template #right>
          <van-button square type="danger" text="åˆ é™¤" @click="deleteIncome(income.id)" />
        </template>
      </van-swipe-cell>
      <van-empty v-if="!incomes.length" description="æš‚æ— è¿›è´¦è®°å½•" />
    </van-cell-group>

    <!-- æ·»åŠ æŒ‰é’® -->
    <van-floating-bubble icon="plus" @click="showAddModal = true" />

    <!-- æ·»åŠ æ¨¡æ€æ¡† -->
    <van-dialog v-model:show="showAddModal" title="æ·»åŠ è¿›è´¦">
      <van-field v-model="newAmount" type="number" label="é‡‘é¢" />
      <template #footer>
        <van-button @click="addRecord">ç¡®å®š</van-button>
      </template>
    </van-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRecordsStore } from '@/stores/records'
import { storeToRefs } from 'pinia'

const recordsStore = useRecordsStore()
const { incomes, expenses } = storeToRefs(recordsStore)

const currentDate = ref(new Date().toISOString().split('T')[0])
const showAddModal = ref(false)
const newAmount = ref('')

onMounted(() => {
  recordsStore.fetchRecords(currentDate.value)
  recordsStore.subscribeToChanges(currentDate.value)
})

async function addRecord() {
  await recordsStore.addIncome(Number(newAmount.value), 'æ¡Œæ¸¸æ”¶å…¥')
  showAddModal.value = false
  newAmount.value = ''
}

function goToYesterday() {
  const date = new Date(currentDate.value)
  date.setDate(date.getDate() - 1)
  currentDate.value = date.toISOString().split('T')[0]
  recordsStore.fetchRecords(currentDate.value)
}

function goToNextDay() {
  const date = new Date(currentDate.value)
  date.setDate(date.getDate() + 1)
  currentDate.value = date.toISOString().split('T')[0]
  recordsStore.fetchRecords(currentDate.value)
}
</script>
```

---

### é˜¶æ®µä¸‰ï¼šCapacitoré›†æˆ (1å‘¨)

#### 3.1 åŸç”ŸåŠŸèƒ½é›†æˆ

**composables/useCamera.ts**
```typescript
import { Camera, CameraResultType } from '@capacitor/camera'

export function useCamera() {
  async function takePicture() {
    const image = await Camera.getPhoto({
      quality: 90,
      allowEditing: false,
      resultType: CameraResultType.DataUrl
    })
    return image.dataUrl
  }

  return { takePicture }
}
```

**composables/useStorage.ts**
```typescript
import { Preferences } from '@capacitor/preferences'

export function useStorage() {
  async function set(key: string, value: any) {
    await Preferences.set({
      key,
      value: JSON.stringify(value)
    })
  }

  async function get(key: string) {
    const { value } = await Preferences.get({ key })
    return value ? JSON.parse(value) : null
  }

  return { set, get }
}
```

#### 3.2 æ„å»ºåŸç”Ÿåº”ç”¨

```bash
# æ„å»ºWebèµ„æº
npm run build

# åŒæ­¥åˆ°åŸç”Ÿé¡¹ç›®
npx cap sync

# æ‰“å¼€Android Studio
npx cap open android

# æ‰“å¼€Xcode (macOS)
npx cap open ios
```

#### 3.3 Androidç‰¹å®šé…ç½®

**android/app/build.gradle**
```gradle
android {
    defaultConfig {
        applicationId "com.e7.accounting"
        minSdkVersion 22
        targetSdkVersion 33
        versionCode 1
        versionName "1.0.0"
    }
}
```

---

### é˜¶æ®µå››ï¼šä¼˜åŒ–ä¸å‘å¸ƒ (1-2å‘¨)

#### 4.1 æ€§èƒ½ä¼˜åŒ–

1. **æ‡’åŠ è½½è·¯ç”±**
```typescript
const routes = [
  {
    path: '/records',
    component: () => import('@/views/RecordsView.vue')
  },
  {
    path: '/stats',
    component: () => import('@/views/StatsView.vue')
  }
]
```

2. **å›¾ç‰‡ä¼˜åŒ–**
```bash
# ä½¿ç”¨Viteæ’ä»¶å‹ç¼©å›¾ç‰‡
npm install -D vite-plugin-imagemin
```

3. **ç¦»çº¿ç¼“å­˜ç­–ç•¥**
```typescript
// ä½¿ç”¨Workbox
import { precacheAndRoute } from 'workbox-precaching'
import { registerRoute } from 'workbox-routing'
import { CacheFirst, NetworkFirst } from 'workbox-strategies'

// é¢„ç¼“å­˜é™æ€èµ„æº
precacheAndRoute(self.__WB_MANIFEST)

// APIè¯·æ±‚ä½¿ç”¨ç½‘ç»œä¼˜å…ˆ
registerRoute(
  ({ url }) => url.pathname.startsWith('/api/'),
  new NetworkFirst()
)
```

#### 4.2 æ•°æ®åº“è®¾è®¡ (Supabase)

**SQL Schema**
```sql
-- ç”¨æˆ·è¡¨ (Supabase Authè‡ªåŠ¨åˆ›å»º)
-- auth.users

-- è®°è´¦è®°å½•è¡¨
CREATE TABLE records (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users NOT NULL,
  type TEXT NOT NULL CHECK (type IN ('income', 'expense')),
  amount DECIMAL(10, 2) NOT NULL,
  category TEXT,
  date DATE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- å€ºåŠ¡è®°å½•è¡¨
CREATE TABLE debts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users NOT NULL,
  name TEXT NOT NULL,
  calculation TEXT NOT NULL,
  result DECIMAL(10, 2) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- çƒŸè‰æ¶ˆè´¹è¡¨
CREATE TABLE tobacco_records (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users NOT NULL,
  brand TEXT NOT NULL,
  quantity DECIMAL(10, 2) NOT NULL,
  price DECIMAL(10, 2) NOT NULL,
  date DATE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)
ALTER TABLE records ENABLE ROW LEVEL SECURITY;
CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„è®°å½•" ON records
  FOR ALL USING (auth.uid() = user_id);

ALTER TABLE debts ENABLE ROW LEVEL SECURITY;
CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„å€ºåŠ¡" ON debts
  FOR ALL USING (auth.uid() = user_id);

ALTER TABLE tobacco_records ENABLE ROW LEVEL SECURITY;
CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„çƒŸè‰è®°å½•" ON tobacco_records
  FOR ALL USING (auth.uid() = user_id);
```

#### 4.3 å‘å¸ƒæ¸…å•

- [ ] ç”Ÿæˆç­¾åå¯†é’¥ (Android)
- [ ] é…ç½®åº”ç”¨å›¾æ ‡å’Œå¯åŠ¨é¡µ
- [ ] è®¾ç½®ç‰ˆæœ¬å·å’Œæ„å»ºå·
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
- [ ] å‡†å¤‡åº”ç”¨å•†åº—èµ„æ–™
  - [ ] åº”ç”¨æè¿°
  - [ ] æˆªå›¾ (è‡³å°‘4å¼ )
  - [ ] éšç§æ”¿ç­–
  - [ ] æœåŠ¡æ¡æ¬¾
- [ ] æäº¤Google Playå®¡æ ¸
- [ ] æäº¤App Storeå®¡æ ¸ (å¦‚éœ€iOS)

---

## ğŸ“Š å…­ã€è¿ç§»æ—¶é—´è¡¨ä¸é‡Œç¨‹ç¢‘

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ | å®Œæˆæ ‡å¿— |
|------|------|--------|---------|
| **é˜¶æ®µä¸€** | ç¯å¢ƒæ­å»º | 1-2å‘¨ | âœ… Viteé¡¹ç›®è¿è¡Œ<br>âœ… Supabaseè¿æ¥æˆåŠŸ<br>âœ… è·¯ç”±é…ç½®å®Œæˆ |
| **é˜¶æ®µäºŒ** | åŠŸèƒ½è¿ç§» | 3-4å‘¨ | âœ… è®°è´¦åŠŸèƒ½å®Œæ•´<br>âœ… å€ºåŠ¡ç®¡ç†è¿ç§»<br>âœ… ç»Ÿè®¡å›¾è¡¨æ˜¾ç¤º<br>âœ… è®¤è¯æµç¨‹æ­£å¸¸ |
| **é˜¶æ®µä¸‰** | åŸç”Ÿé›†æˆ | 1å‘¨ | âœ… Android APKæ‰“åŒ…æˆåŠŸ<br>âœ… iOSæ„å»ºé€šè¿‡<br>âœ… åŸç”ŸåŠŸèƒ½æµ‹è¯• |
| **é˜¶æ®µå››** | ä¼˜åŒ–å‘å¸ƒ | 1-2å‘¨ | âœ… æ€§èƒ½è¾¾æ ‡(Lighthouse 90+)<br>âœ… åº”ç”¨å•†åº—èµ„æ–™å‡†å¤‡<br>âœ… æ­£å¼ä¸Šæ¶ |

**æ€»è®¡ï¼š6-9å‘¨ (1.5-2.5ä¸ªæœˆ)**

---

## ğŸ¯ ä¸ƒã€é£é™©è¯„ä¼°ä¸åº”å¯¹ç­–ç•¥

### 7.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | åº”å¯¹ç­–ç•¥ |
|------|------|---------|
| Vue 2åˆ°Vue 3è¿ç§»å›°éš¾ | ä¸­ | ä½¿ç”¨Vue 3è¿ç§»æ„å»ºå·¥å…·ï¼Œé€æ­¥è¿ç§» |
| Supabaseå®æ—¶è®¢é˜…å»¶è¿Ÿ | ä½ | æœ¬åœ°ç¼“å­˜+ä¹è§‚æ›´æ–° |
| Capacitoræ’ä»¶å…¼å®¹æ€§ | ä½ | ä½¿ç”¨å®˜æ–¹æ’ä»¶ï¼Œé¿å…ç¤¾åŒºæ’ä»¶ |
| TypeScriptå­¦ä¹ æ›²çº¿ | ä¸­ | æ¸è¿›å¼é‡‡ç”¨ï¼Œå…ˆç”¨anyå†å®Œå–„ |

### 7.2 ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | åº”å¯¹ç­–ç•¥ |
|------|------|---------|
| æ•°æ®è¿ç§»ä¸¢å¤± | é«˜ | å¤šé‡å¤‡ä»½ï¼Œæµ‹è¯•ç¯å¢ƒéªŒè¯ |
| ç”¨æˆ·ä¹ æƒ¯æ”¹å˜ | ä¸­ | ä¿æŒUIä¸€è‡´æ€§ |
| ä¸Šæ¶å®¡æ ¸è¢«æ‹’ | ä¸­ | æå‰ç ”ç©¶åº”ç”¨å•†åº—æ”¿ç­– |

---

## ğŸ’¡ å…«ã€æœ€ä½³å®è·µå»ºè®®

### 8.1 ä»£ç è§„èŒƒ

```typescript
// ä½¿ç”¨Composition API
// âœ… æ¨è
const { incomes, expenses } = useRecords()

// âŒ é¿å…
export default {
  data() {
    return { incomes: [] }
  }
}

// ç±»å‹å®‰å…¨
// âœ… æ¨è
interface Record {
  id: string
  amount: number
  type: 'income' | 'expense'
}

const records: Record[] = []

// âŒ é¿å…
const records: any[] = []
```

### 8.2 æ•°æ®åŒæ­¥ç­–ç•¥

```typescript
// ä¹è§‚æ›´æ–° + åå°åŒæ­¥
async function addIncome(amount: number) {
  // 1. ç«‹å³æ›´æ–°UI
  const tempId = Date.now()
  incomes.value.push({ id: tempId, amount, synced: false })

  try {
    // 2. åå°åŒæ­¥åˆ°Supabase
    const { data } = await supabase.from('records').insert({ amount })

    // 3. æ›¿æ¢ä¸´æ—¶ID
    const index = incomes.value.findIndex(i => i.id === tempId)
    incomes.value[index] = { ...data, synced: true }
  } catch (error) {
    // 4. å¤±è´¥å›æ»š
    incomes.value = incomes.value.filter(i => i.id !== tempId)
    showError('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ')
  }
}
```

### 8.3 æ€§èƒ½ç›‘æ§

```typescript
// ä½¿ç”¨Viteæ’ä»¶ç›‘æ§æ‰“åŒ…ä½“ç§¯
import { visualizer } from 'rollup-plugin-visualizer'

export default {
  plugins: [
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true,
    })
  ]
}
```

---

## ğŸ”— ä¹ã€ç›¸å…³èµ„æºé“¾æ¥

### å®˜æ–¹æ–‡æ¡£
- [Vue 3å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/)
- [Viteå®˜æ–¹æ–‡æ¡£](https://cn.vitejs.dev/)
- [Piniaå®˜æ–¹æ–‡æ¡£](https://pinia.vuejs.org/zh/)
- [Vant 4ç»„ä»¶åº“](https://vant-ui.github.io/vant/#/zh-CN)
- [Supabaseå®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
- [Capacitorå®˜æ–¹æ–‡æ¡£](https://capacitorjs.com/docs)

### æ•™ç¨‹èµ„æº
- [Vue 3 + Supabaseå®Œæ•´æ•™ç¨‹](https://supabase.com/docs/guides/getting-started/tutorials/with-vue-3)
- [Capacitor Androidå‘å¸ƒæŒ‡å—](https://capacitorjs.com/docs/android/deploying-to-google-play)
- [Viteæ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](https://cn.vitejs.dev/guide/performance.html)

---

## âœ… åã€æ€»ç»“ä¸è¡ŒåŠ¨å»ºè®®

### æ ¸å¿ƒç»“è®º

1. **é¡¹ç›®ç°çŠ¶**ï¼šæ‚¨çš„é¡¹ç›®æ˜¯ä¸€ä¸ªæˆç†Ÿçš„PWAåº”ç”¨ï¼Œå·²å…·å¤‡CapacitoråŸºç¡€
2. **è¿ç§»ä»·å€¼**ï¼šè¿ç§»ä¸ºåŸç”ŸAppå¯è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå•†ä¸šä»·å€¼
3. **æœ€ä½³æ–¹æ¡ˆ**ï¼šVue 3 + Vite + Pinia + Supabase + Capacitor
4. **æ—¶é—´æˆæœ¬**ï¼šé¢„è®¡6-9å‘¨å®Œæˆå®Œæ•´è¿ç§»
5. **æŠ€æœ¯éš¾åº¦**ï¼šä¸­ä½éš¾åº¦ï¼Œé£é™©å¯æ§

### ç«‹å³è¡ŒåŠ¨

**ç¬¬ä¸€æ­¥ï¼ˆæœ¬å‘¨ï¼‰ï¼š**
```bash
# 1. åˆ›å»ºæ–°é¡¹ç›®
npm create vite@latest e7-accounting-app -- --template vue-ts

# 2. å®‰è£…æ ¸å¿ƒä¾èµ–
cd e7-accounting-app
npm install vue-router@4 pinia @supabase/supabase-js vant@4

# 3. é…ç½®Supabase
# å¤åˆ¶ç°æœ‰çš„supabase.jsé…ç½®åˆ°æ–°é¡¹ç›®

# 4. è¿ç§»ç¬¬ä¸€ä¸ªé¡µé¢ï¼ˆè®°è´¦é¡µï¼‰
# éªŒè¯å¯è¡Œæ€§
```

**ç¬¬äºŒæ­¥ï¼ˆä¸‹å‘¨ï¼‰ï¼š**
- å®Œæˆè®¤è¯æµç¨‹è¿ç§»
- æ­å»ºå®Œæ•´çš„PiniaçŠ¶æ€ç®¡ç†
- è¿ç§»å€ºåŠ¡å’Œç»Ÿè®¡æ¨¡å—

**ç¬¬ä¸‰æ­¥ï¼ˆç¬¬ä¸‰å‘¨ï¼‰ï¼š**
- é›†æˆCapacitor
- æµ‹è¯•Androidæ„å»º
- ä¼˜åŒ–æ€§èƒ½

---

### éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæ‚¨åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. å‚è€ƒæœ¬æ–‡æ¡£çš„ä»£ç ç¤ºä¾‹
2. æŸ¥é˜…å®˜æ–¹æ–‡æ¡£
3. åœ¨GitHubä¸ŠæŸ¥çœ‹Supabase + Vue 3çš„ç¤ºä¾‹é¡¹ç›®
4. åŠ å…¥Vue.jså’ŒSupabaseçš„ç¤¾åŒºè®¨è®º

**ç¥æ‚¨è¿ç§»é¡ºåˆ©ï¼** ğŸš€
